<!DOCTYPE html>
<html>
<head>
    <title>Тест мессенджер</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .message { padding: 10px; margin: 5px; border-radius: 5px; }
        .out { background: #dcf8c6; text-align: right; }
        .in { background: #fff; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h2>Тестовый чат (откройте в двух вкладках)</h2>
    
    <input type="text" id="user" placeholder="Ваше имя" value="User1">
    <input type="text" id="message" placeholder="Сообщение">
    <button onclick="sendMessage()">Отправить</button>
    
    <div id="chat"></div>

    <script>
        // Используем localStorage для симуляции обмена сообщениями
        function sendMessage() {
            const user = document.getElementById('user').value;
            const message = document.getElementById('message').value;
            
            if (!message) return;
            
            // Сохраняем сообщение
            const messages = JSON.parse(localStorage.getItem('chat_messages') || '[]');
            messages.push({ user, message, time: new Date().toLocaleTimeString() });
            localStorage.setItem('chat_messages', JSON.stringify(messages));
            
            // Добавляем в чат
            addMessageToChat(user, message, true);
            document.getElementById('message').value = '';
        }

        function addMessageToChat(user, message, isOwn) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            div.className = `message ${isOwn ? 'out' : 'in'}`;
            div.innerHTML = `<strong>${user}:</strong> ${message} <small>${new Date().toLocaleTimeString()}</small>`;
            chat.appendChild(div);
        }

        // Проверяем новые сообщения
        function checkMessages() {
            const messages = JSON.parse(localStorage.getItem('chat_messages') || '[]');
            const currentUser = document.getElementById('user').value;
            const chat = document.getElementById('chat');
            
            // Показываем только последние 10 сообщений
            const recentMessages = messages.slice(-10);
            chat.innerHTML = '';
            
            recentMessages.forEach(msg => {
                addMessageToChat(msg.user, msg.message, msg.user === currentUser);
            });
        }

        // Проверяем каждую секунду
        setInterval(checkMessages, 1000);
        checkMessages(); // Первоначальная загрузка
    </script>
</body>
</html>
